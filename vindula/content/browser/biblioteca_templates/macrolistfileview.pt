<metal:view_macro define-macro="view">

    <tal:block define="view_macro python:context.restrictedTraverse('macro_list_file');
                     Batch python:modules['Products.CMFPlone'].Batch;
                     b_size request/b_size|string:5;
                     b_start python:0;
                     b_start request/b_start | b_start;
                     theme theme|request/theme|nothing;
                     structures structures|request/structures|nothing;
                     sort_on request/sort_on|string:access;
                     list_files python: view_macro.list_files(theme,structures,sort_on) or [];
                     batch python:Batch(list_files, int(b_size), int(b_start), pagerange=len(list_files));"
               condition="batch">

        <div tal:attributes="class string:row list_file ${theme|structures/Title|nothing}" id="list_file">
	        <div class="titulo_area columns large-12">
	            <h5 class="left" tal:condition="theme">
	                <a href="#" tal:content="theme" tal:attributes="href string: ${context/absolute_url|nothing}/list-filter?theme=${theme}"></a>
                </h5>
	            <h5 class="left" tal:condition="structures">
	                <a href="#" tal:define="structure_title structures/Title| python: view_macro.getStructures_byUID(structures).Title()"
                                tal:content="structure_title"
                                tal:attributes="href string: ${context/absolute_url|nothing}/list-filter?structures=${structures/UID|structures}"></a>
                </h5>
                <div class="right">
                    <form class="left custom">
                        <select name="order_by"  id="customDropdown" class="right order_by medium">
                            <option value="access" tal:attributes="selected python: sort_on=='access' and 'selected' or ''">Mais Acessados</option>
                            <option value="effective" tal:attributes="selected python: sort_on=='effective' and 'selected' or ''">Itens Recentes</option>
                        </select>
                    </form>
                    <div class="right" id="pag-nav">
                        <metal:block metal:use-macro="context/boll_batch/macros/navigation" />
                    </div>
                </div>
                <hr/>

	        </div>

	        <input type="hidden" id="b_size" tal:attributes="value b_size" />
	        <input type="hidden" id="b_start" tal:attributes="value b_start" />
	        <input type="hidden" id="theme" tal:attributes="value theme" />
            <input type="hidden" id="structures" tal:attributes="value structures/UID|structures" />
	        <input type="hidden" id="absolute_url" tal:attributes="value string:${context/portal_url}/macro_list_file" />

            <div class="list-container columns large-12">
                <div class="row">
                    <tal:rep repeat="item batch">
                        <tal:cond condition="repeat/item/start">
                            <div class="columns large-6">
                                <metal:define define-macro="contenttype">
                                    <div class="container-of-type" tal:define="item_object item/getObject|python:item">

                                        <div class="image-content">
                                            <img class="type-file"
                                                 src="++theme++vindula.themedefault/images/demos/demo2-Banner_Destaque.jpg"
                                                 tal:attributes="src python: view_macro.get_url_typeIcone(item_object)"/>
                                        </div>

                                        <div class="number-of-type">
                                            <h6 tal:content="repeat/item/number"></h6>
                                        </div>
                                        <div class="caption-of-type">
                                            <a tal:attributes="href item_object/absolute_url"><strong tal:content="item_object/Title"></strong></a>
                                            <p tal:condition="item_object/getStructures|nothing"
                                                tal:content="python:'%s%s' %
                                                            (item_object.getStructures() and item_object.getStructures().Title()+' / ',
                                                            item_object.bobobase_modification_time().strftime('%d/%m/%Y'))"></p>
                                        </div>
                                    </div>
                                </metal:define>
                            </div>
                        </tal:cond>

                        <tal:cond condition="not: repeat/item/start">

                            <tal:cond condition="python:repeat['item'].number() == 2 or repeat['item'].number() == 4">
                                <tal:structure content="structure python: view_macro.getRowCssClass()"></tal:structure>
                                <!-- Esta renderizando a string a baixo -->
                                <!--div class="columns large-3"><div class="row">-->
                            </tal:cond>

                            <div class="columns large-12">
                                <metal:use use-macro="context/macro_list_file/macros/contenttype" />
                            </div>

                            <tal:cond condition="python:repeat['item'].number() == 3 or repeat['item'].number() == 5 or len(batch) == 2 or len(batch) == 4">
                                <tal:structure content="structure python:'</div>\n</div>'"></tal:structure>
                            </tal:cond>

                        </tal:cond>
                    </tal:rep>
                </div>
            </div>
            <!-- Spinner -->
            <div id="spinner" class="display-none" style="text-align:center; margin: 30px;">
                <img src="" alt="spinner" align="center" tal:attributes="src string:${context/portal_url}/++resource++vindula.myvindula.views/ajaxLoader.gif" />
            </div>
		</div>
    </tal:block>
</metal:view_macro>
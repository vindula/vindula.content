<metal:view_macro define-macro="view">

    <script type="text/javascript" src=""
                tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/ajax_filter_file.js"></script>

    <tal:def define="view_macro python:context.restrictedTraverse('macro_filter_file');

                     is_theme is_theme|nothing;
                     is_structures is_structures|nothing;

                     themes request/themes[]|python:[];
                     structures request/structures[]|python:[];

                     list_filter python: view_macro.list_filter(is_theme,is_structures) or [];">
        
        <div class="section-biblioteca-accordion filterFile" id="filter_file">
                <p class="title-filter">
                    <a href="#">
                        <i class="more-itens vindula-icon-plus-sign"></i>
                        <span class="more-itens" 
                              tal:content="python:'Refinar %s' % (is_theme and 'Tema' or 'Unidade')"></span>
                        <span class="right" 
                              tal:content="python:'Total de %s: (%s)' % (is_theme and 'Temas' or 'Unidades', len(list_filter))"></span>
                    </a>
                </p>
                <div class="content-filter">
                    <div class="columns-tag">
                        <tal:rep repeat="item list_filter">
                            <tal:def define="item_obj item/getObject|item;
                                             item_id  item_obj/UID|item_obj">
                                <div tal:condition="is_theme">
                                  <label tal:attributes="for item_id;">
                                      <input tal:attributes="value item_id;
                                                             id item_id;
                                                             CHECKED python:item_id in themes and 'checked' or '';"
                                             type="checkbox" class="filter" name="theme" />
                                      <span class="checkbox">
                                          <tal:cont content="item_obj/title">title</tal:cont>
                                      </span>
                                      
                                  </label>
                                </div>
                                
                                <div tal:condition="is_structures">
                                  <label tal:attributes="for item_id;">
                                      <input tal:attributes="value item_id;
                                                             id item_id;
                                                             CHECKED python:item_id in structures and 'checked' or '';"
                                             type="checkbox" class="filter" name="structures" />
                                      <span class="checkbox"></span>
                                      <tal:cont content="item_obj/title">title</tal:cont>
                                  </label>
                                </div>
                            </tal:def>
                        </tal:rep>
                    </div>
                    
                    <ul class="button-group">
                        <li><a class='clearFilter tiny button'>Limpar Filtro</a></li>
                        <li><a class='execFilter tiny button'>Aplicar</a></li>
                    </ul>
                </div>
            <!-- Spinner -->
            <div id="spinner" class="display-none" style="text-align:center; margin: 30px;">
                <img src="" alt="spinner" align="center" tal:attributes="src string:${context/portal_url}/++resource++vindula.myvindula.views/ajaxLoader.gif" />
            </div>
        </div>
    </tal:def>
</metal:view_macro>

<metal:view_macro define-macro="tabular">

    <link rel="stylesheet" href="" type="text/css"
          tal:attributes="href string:${context/absolute_url|nothing}/++resource++vindula.content/js/select/jquery.multiselect.css">
    <script type="text/javascript"
            tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/select/jquery.multiselect.min.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/select/jquery.multiselect.filter.min.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/select/i18n/jquery.multiselect.br.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/select/i18n/jquery.multiselect.filter.br.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/select/select_filter.js"></script>


    <script type="text/javascript" src=""
                tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/ajax_filter_file.js"></script>


     <tal:def define="view_macro python:context.restrictedTraverse('macro_filter_file');
                      subject request/subject|python:'';

                      req_keywords request/keywords|request/keywords[]|python:'';
                      req_structures request/structures|request/structures[]|python:'';

                      list_filter python: view_macro.tabular_filter();">
                          
        <div class="section-biblioteca-accordion filterFile" id="filter_file">
            <p class="title-filter hasInput">
                <a href="#">
                    <i class="more-itens vindula-icon-plus-sign"></i>
                    <span class="more-itens">Refinar Pesquisa</span>
                </a>
                <input type="text" class="filter right" name="subject" tal:attributes="value subject" />
            </p>
            <div class="content-filter">
                <form class="form-columns-tag">
                    <div class="tags left">
                        <label>
                            Tipo
                        </label>
                        <select name="keywords" id="keywords" class="filter select-filter" 
                                multiple="multiple" tal:define="tags list_filter/tags">
                            <option tal:repeat="item tags" tal:attributes="value item;
                                    selected python:item in req_keywords and 'selected' or '';"
                                    tal:content="item"></option>
                        </select>
                    </div>
                    <div class="structures left">
                        <label>
                            Unidade
                        </label>
                        <select name="structures" id="structures" class="filter select-filter" multiple="multiple" tal:define="structures list_filter/structures">
                            <option tal:repeat="item structures" tal:attributes="value item/UID;
                                    selected python:item.UID in req_structures and 'selected' or '';""
                                    tal:content="item/Title"></option>
                        </select>
                    </div>
                </form>
            </div>
            <ul class="button-group external">
                <li><a class='execFilter tiny button'>Aplicar</a></li>
                <li><a class='clearFilter tiny button'>Limpar Filtro</a></li>
            </ul>
            <!-- Spinner -->
            <div id="spinner" class="display-none" style="text-align:center; margin: 30px;">
                <img src="" alt="spinner" align="center" tal:attributes="src string:${context/portal_url}/++resource++vindula.myvindula.views/ajaxLoader.gif" />
            </div>
        </div>
    </tal:def>
</metal:view_macro>




<metal:view_macro define-macro="view">

    <script type="text/javascript" src=""
                tal:attributes="src string:${context/absolute_url|nothing}/++resource++vindula.content/js/ajax_list_file.js"></script>
    <script type="text/javascript" src=""
                tal:attributes="src string:${context/absolute_url|nothing}/table_sorter.js"></script>

    <div class="filterFile list_file" id="list_file">

        <tal:def tal:define="view_macro python:context.restrictedTraverse('macro_tabular_file');
                             Batch python:modules['Products.CMFPlone'].Batch;
                             b_size request/b_size|string:10;
                             b_start python:0;
                             b_start request/b_start | b_start;
                             portal_type portal_type|request/portal_type|nothing;
                             fields fields|python:eval(request.fields) or None;
                             subject request/subject|python:'';
                             keywords request/keywords|request/keywords[]|python:'';
                             structures request/structures|request/structures[]|python:'';
                             list_files python: view_macro.list_files(subject,keywords,structures, portal_type) or [];
                             batch python:Batch(list_files, int(b_size), int(b_start), pagerange=len(list_files));">

            <input type="hidden" id="b_size" tal:attributes="value b_size" />
            <input type="hidden" id="b_start" tal:attributes="value b_start" />
            <input type="hidden" id="portal_type" name="portal_type" tal:attributes="value portal_type">
            <input type="hidden" id="fields" name="fields" tal:attributes="value fields">
            <input type="hidden" id="absolute_url" tal:attributes="value string:${context/portal_url}/macro_tabular_file" >
            <meta:macro metal:define-macro="navegacao-macro">
                <div id="paginacao">
                    <div id="size-nav" class="left">
                        <p>
                            <span tal:content="python:'Total: ('+str(len(list_files))+')'">Total (XX)</span>
                            |
                            <span tal:define="css python:'font-weight:bolder;;'">Itens por pagina:
                                <a class="c-pointer" id="itenspage"
                                   tal:attributes="style python:b_size == '10' and css or '' ">10</a>,
                                <a class="c-pointer" id="itenspage"
                                   tal:attributes="style python:b_size == '20' and css or '' ">20</a>,
                                <a class="c-pointer" id="itenspage"
                                   tal:attributes="style python:b_size == '30' and css or '' ">30</a>,
                                <a class="c-pointer" id="itenspage"
                                   tal:attributes="style python:b_size == '40' and css or '' ">40</a>
                            </span>
                        </p>
                    </div>
                    <div id="pag-nav" class="right">
                        <metal:block metal:use-macro="context/boll_batch/macros/navigation" />
                    </div>
                </div>
                <div class="visualClear"></div>
            </meta:macro>
            <div class="visualClear"></div>
            <table class="listing blue-head" width="100%"
                   tal:define="fields fields|nothing;">
                <thead>
                    <tr>
                        <tal:rep repeat="field fields">
                             <th tal:content="field/label"></th>
                        </tal:rep>
                    </tr>
                </thead>
                <tbody>
                    <tr tal:repeat="item batch">
                        <tal:rep repeat="field fields"
                                 define="item_object item/getObject|python: item;">
                            <td tal:define="value_field python: view_macro.getValueField(item_object, field['attribute'])">
                                <a target="_blank"
                                   tal:attributes="href value_field/url;
                                                   title value_field/name">
                                    <span tal:content="value_field/value"></span>
                                </a>
                            </td>
                        </tal:rep>
                    </tr>
                </tbody>
             </table>
             <metal:block metal:use-macro="context/macro_tabular_file/macros/navegacao-macro" />
        </tal:def>
    </div>
</metal:view_macro>